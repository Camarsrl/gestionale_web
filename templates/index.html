@app.route('/')
def index():
    query = Articolo.query
    if session.get('role') == 'client':
        query = query.filter(Articolo.cliente.ilike(session['user']))

    # Logica dei filtri (questa parte mancava o era incompleta)
    filters = request.args.to_dict()
    if filters:
        if filters.get('id'):
            query = query.filter(Articolo.id == filters['id'])
        if filters.get('codice_articolo'):
            query = query.filter(Articolo.codice_articolo.ilike(f"%{filters['codice_articolo']}%"))
        if filters.get('descrizione'):
            query = query.filter(Articolo.descrizione.ilike(f"%{filters['descrizione']}%"))
        if filters.get('cliente'):
            query = query.filter(Articolo.cliente.ilike(f"%{filters['cliente']}%"))
        if filters.get('commessa'):
            query = query.filter(Articolo.commessa.ilike(f"%{filters['commessa']}%"))
        # Aggiungi qui altri filtri se necessario...

    articoli = query.order_by(Articolo.id.desc()).all()
    
    totali = { 'colli': 0, 'peso': 0.0, 'm2': 0.0, 'm3': 0.0 }
    articoli_in_giacenza = [art for art in articoli if not art.n_ddt_uscita]
    for art in articoli_in_giacenza:
        totali['colli'] += art.n_colli or 0
        totali['peso'] += art.peso or 0.0
        totali['m2'] += art.m2 or 0.0
        totali['m3'] += art.m3 or 0.0

    # La modifica chiave Ã¨ qui: viene passata la variabile 'filters' al template
    return render_template('index.html', articoli=articoli, totali=totali, filters=filters)
