{% extends "layout.html" %}

{% block content %}
<div class="card p-4">
    <h3>{{ title }}</h3>
    <hr>
    <form method="post" enctype="multipart/form-data">
        <h5 class="mt-3">Dati Anagrafici</h5>
        <div class="row g-3">
            <div class="col-md-6">
                <label for="codice_articolo" class="form-label">Codice Articolo</label>
                <input type="text" class="form-control" id="codice_articolo" name="codice_articolo" value="{{ articolo.codice_articolo if articolo else '' }}">
            </div>
            <div class="col-md-6">
                <label for="descrizione" class="form-label">Descrizione</label>
                <input type="text" class="form-control" id="descrizione" name="descrizione" value="{{ articolo.descrizione if articolo else '' }}">
            </div>
            <div class="col-md-6">
                <label for="cliente" class="form-label">Cliente</label>
                <input type="text" class="form-control" id="cliente" name="cliente" value="{{ articolo.cliente if articolo else '' }}">
            </div>
            <div class="col-md-6">
                <label for="fornitore" class="form-label">Fornitore</label>
                <input type="text" class="form-control" id="fornitore" name="fornitore" value="{{ articolo.fornitore if articolo else '' }}">
            </div>
        </div>

        <h5 class="mt-4">Dati Logistici</h5>
        <div class="row g-3">
            <div class="col-md-3">
                <label for="n_colli" class="form-label">Numero Colli</label>
                <input type="number" class="form-control" id="n_colli" name="n_colli" value="{{ articolo.n_colli if articolo else '' }}">
            </div>
            <div class="col-md-3">
                <label for="peso" class="form-label">Peso (Kg)</label>
                <input type="text" class="form-control" id="peso" name="peso" value="{{ articolo.peso if articolo else '' }}">
            </div>
            <div class="col-md-2">
                <label for="lunghezza" class="form-label">Lunghezza (m)</label>
                <input type="text" class="form-control" id="lunghezza" name="lunghezza" value="{{ articolo.lunghezza if articolo else '' }}">
            </div>
            <div class="col-md-2">
                <label for="larghezza" class="form-label">Larghezza (m)</label>
                <input type="text" class="form-control" id="larghezza" name="larghezza" value="{{ articolo.larghezza if articolo else '' }}">
            </div>
             <div class="col-md-2">
                <label for="altezza" class="form-label">Altezza (m)</label>
                <input type="text" class="form-control" id="altezza" name="altezza" value="{{ articolo.altezza if articolo else '' }}">
            </div>
        </div>

        <h5 class="mt-4">Dati Ingresso</h5>
        <div class="row g-3">
            <div class="col-md-4">
                <label for="data_ingresso" class="form-label">Data Ingresso</label>
                <input type="date" class="form-control" id="data_ingresso" name="data_ingresso" value="{{ articolo.data_ingresso.isoformat() if articolo and articolo.data_ingresso else '' }}">
            </div>
            <div class="col-md-4">
                <label for="n_ddt_ingresso" class="form-label">N. DDT Ingresso</label>
                <input type="text" class="form-control" id="n_ddt_ingresso" name="n_ddt_ingresso" value="{{ articolo.n_ddt_ingresso if articolo else '' }}">
            </div>
             <div class="col-md-4">
                <label for="commessa" class="form-label">Commessa</label>
                <input type="text" class="form-control" id="commessa" name="commessa" value="{{ articolo.commessa if articolo else '' }}">
            </div>
        </div>
        
        <h5 class="mt-4">Altri Dati</h5>
        <div class="row g-3">
            <div class="col-md-4">
                <label for="posizione" class="form-label">Posizione</label>
                <input type="text" class="form-control" id="posizione" name="posizione" value="{{ articolo.posizione if articolo else '' }}">
            </div>
            <div class="col-md-8">
                <label for="note" class="form-label">Note</label>
                <textarea class="form-control" id="note" name="note" rows="1">{{ articolo.note if articolo else '' }}</textarea>
            </div>
        </div>

        {% if articolo %}
        <h5 class="mt-4">Allegati</h5>
        <div class="mb-3">
            <label for="files" class="form-label">Carica nuovi allegati (foto o documenti)</label>
            <input class="form-control" type="file" id="files" name="files" multiple>
        </div>
        {% if articolo.allegati %}
        <p>Allegati presenti:</p>
        <ul class="list-group">
            {% for allegato in articolo.allegati %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <a href="{{ url_for('uploaded_file', filename=allegato.filename) }}" target="_blank">{{ allegato.filename }}</a>
                <form action="{{ url_for('delete_attachment', id=allegato.id) }}" method="post" onsubmit="return confirm('Sei sicuro di voler eliminare questo allegato?');">
                    <button type="submit" class="btn btn-sm btn-danger">Elimina</button>
                </form>
            </li>
            {% endfor %}
        </ul>
        {% endif %}
        {% endif %}

        <div class="mt-4">
            <button type="submit" class="btn btn-primary">Salva Modifiche</button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Annulla</a>
        </div>
    </form>
</div>
{% endblock %}
